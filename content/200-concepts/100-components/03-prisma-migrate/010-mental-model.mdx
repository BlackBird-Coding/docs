---
title: Mental Model
metaDescription:
tocDepth: 2
---

## Database migrations

Migrations are a controlled set of changes that modify the structure of objects within your database. Migrations help you transition your database schema from one state to another, for example, creating or removing tables and columns, splitting fields in a table, or adding types and constraints to your database.

Migrations are important when working with databases because they provide a systematic way to evolve the database schema.

## Evolving a database schema

There are two main patterns in you can incrementally update your database schema:

- **Database first** — involves defining the structure of your database and applying it to your database using SQL and then _introspecting_ the database to generate the code that describes the structure of your database to sync your application and database schema

**TODO**: database first image

- **Code first** — involves defining the structure of the database schema using code and then using a migration tool to generate the SQL, for example, for syncing your application and database schema

**TODO**: code first image

Artifacts describing schema updates would ideally be stored together with your application code. It would also be tracked in version control and shared with the rest of the team working on the application.

Migrations provide _state management_ which helps with tracking the state of the database.

Migrations also allow you to replicate the state of a database at a specific point in time which is useful when collaborating with other members of the team, e.g. switching between different branches.

For further details on what database migrations are, see the [Prisma Data Guide](https://www.prisma.io/dataguide/types/relational/what-are-database-migrations).

### Prisma Migrate

Prisma Migrate is a database migration tool that provides a _code first_ approach for managing the database schema – from your local environment all the way to production.

The workflow when using Prisma Migrate in your project would be iterative and look like this:

- Define your Prisma schema – the source of truth
- Use one of the Prisma CLI commands to sync your Prisma schema with the database schema

**TODO**: image showing an iterative process

Prisma Migrate uses the following pieces of state to track the state of your database schema:

- **Prisma schema**: the main configuration file (data source, generators, and data models)
- **Migrations history**: the generated migration steps represented in `/migrations` folder
- **Migrations table**: table in the database that stores metadata of the already applied migrations (`_prisma_migrations`)
- **Database schema**: the _state_ of the database

**TODO**: add image showing where each piece fits in the application stack

## Development environments

### Schema prototyping

Prisma Migrate provides `db push` which allows you to synchronize your Prisma schema with the database schema without persisting a migration to the `prisma/migrations` directory.

`db push` uses the **Prisma schema** and **database schema** to track the state of the database.

Under the hood, `db push` does the following:

1. Introspects your database
2. Infers changes by making a diff of your database and Prisma schema
3. Applies the changes to your database schema

**TODO**: image visualizing the process

`db push` is great for quickly prototyping and iterating on the database schema without the need to persist a migration history.

### Developing with `prisma migrate dev`

The `migrate dev` is a development command used to automatically generates the SQL migration files used to keep track of the database' schema state.

`prisma migrate dev` tracks the database _state_ in two additional locations besides the database and Prisma schema:

- Migrations history
- Migrations table

`migrate dev` is intended to be used with with disposable databases (in development).

**TODO**: image visualizing the process/ flow

Under the hood — link to illustration.

#### Customizing migrations

In some cases, you may need to edit a migration before applying it to the database. Prisma Migrate allows you to create a draft migration with the `--create-only` flag.

Once you're ready apply the migration, you can re-run `migrate dev` to apply the migration to the database.

**TODO**: image visualizing the process/ flow

## Preview and production environments

In a preview or production environments, you can apply migrations to your database using `migrate deploy`. The command should ideally be run in an automated CI/ CD environment to apply the changes to the database (preview/ production environment).

Under the hood, `migrate deploy` will:

- Compare applied changes with migration history
- Applies pending migrations

**TODO**: image visualizing the process/ flow

`migrate deploy` syncs your migration history (from your local environment) with the database (in the environment you're using). It does this applying pending migrations in the migrations history and updating the `_prisma_migrations` table.

## Fixing failed migrations

Sometimes, applying a migration might fail when being applied to the database. Prisma Migrate tracks the status of a migration in a `logs` column in the `_prisma_migrations` table.

In some situations:

- The database schema might be ahead (of the Prisma schema, migrations history and table) and needs to be reverted
- May be behind and requires to be moved forward.

**TODO**: image visualizing the process/ flow

- Moving backwards to revert changes

- Moving forward to apply missing changes
